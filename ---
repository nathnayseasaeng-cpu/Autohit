--// ===== CONFIG ===== //--
getgenv().AutoPunch = true        -- เปิด/ปิดตีผู้เล่น
local RANGE = 50                   -- ระยะชก
local CHECK_TIME = 0.15           -- เวลาเช็คผู้เล่น
local ESP_TIME = 0.5              -- เวลาเช็คไอเทม

-- ไอเทมใน Workspace ที่ทำ ESP + สี
local DROP_ITEMS = {
    ["M9"] = Color3.fromRGB(0,150,255),        -- สีฟ้า
    ["KeyCard"] = Color3.fromRGB(255,215,0),   -- สีทอง
    ["Key card"] = Color3.fromRGB(255,215,0)   -- รองรับชื่อเว้นวรรค
}

--// ===== SERVICES ===== //--
local Players = game:GetService("Players")
local RS = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")

--// ===== REMOTE ===== --
local event = RS:WaitForChild("meleeEvent")

--// ===== LOCAL PLAYER ===== --
local LP = Players.LocalPlayer
local Char = LP.Character or LP.CharacterAdded:Wait()
LP.CharacterAdded:Connect(function(c)
    Char = c
end)

--// ===== FUNCTIONS ===== --

-- Auto Punch
task.spawn(function()
    while task.wait(CHECK_TIME) do
        if not getgenv().AutoPunch then continue end
        local HRP = Char and Char:FindFirstChild("HumanoidRootPart")
        if not HRP then continue end

        for _, plr in ipairs(Players:GetPlayers()) do
            if plr ~= LP and plr.Character then
                local tHRP = plr.Character:FindFirstChild("HumanoidRootPart")
                local tHum = plr.Character:FindFirstChild("Humanoid")
                if tHRP and tHum and tHum.Health > 0 then
                    local dist = (HRP.Position - tHRP.Position).Magnitude
                    if dist <= RANGE then
                        pcall(function()
                            event:FireServer(plr)
                        end)
                    end
                end
            end
        end
    end
end)

-- ฟังก์ชันสร้าง ESP
local function addESP(obj, color)
    if obj:FindFirstChild("ITEM_ESP") then return end

    -- Highlight Box
    local hl = Instance.new("Highlight")
    hl.Name = "ITEM_ESP"
    hl.FillColor = color
    hl.FillTransparency = 0.7
    hl.OutlineColor = color
    hl.Adornee = obj
    hl.Parent = obj

    -- Name Tag
    local bb = Instance.new("BillboardGui")
    bb.Name = "ITEM_ESP"
    bb.Size = UDim2.new(0, 120, 0, 22)
    bb.Adornee = obj
    bb.AlwaysOnTop = true
    bb.Parent = obj

    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, 0, 1, 0)
    label.BackgroundTransparency = 1
    label.TextColor3 = color
    label.TextStrokeTransparency = 0.4
    label.Font = Enum.Font.SourceSansBold
    label.TextScaled = true
    label.Text = obj.Name
    label.Parent = bb
end

-- ตรวจไอเทมดรอปใน Workspace
task.spawn(function()
    while task.wait(ESP_TIME) do
        for _, obj in ipairs(Workspace:GetChildren()) do
            if DROP_ITEMS[obj.Name] and obj:IsA("Model") then
                addESP(obj, DROP_ITEMS[obj.Name])
            end
        end
    end
end)
