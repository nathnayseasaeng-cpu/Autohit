local Players = game:GetService("Players")
local LP = Players.LocalPlayer
local Camera = workspace.CurrentCamera
local RunService = game:GetService("RunService")

local Config = {
    Target = nil,
    Locked = false,
    TeamCheck = true,
    BulletSpeed = 250,
    IsMinimized = false,
    LastTargetTime = 0,
    LockDelay = 0.8 
}


local SG = Instance.new("ScreenGui", game:GetService("CoreGui"))
local MainFrame = Instance.new("Frame", SG)
MainFrame.Position = UDim2.new(0, 100, 0, 20)
MainFrame.Size = UDim2.new(0, 140, 0, 140)
MainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
MainFrame.BorderSizePixel = 2
MainFrame.ClipsDescendants = true 


local ShutterBtn = Instance.new("TextButton", MainFrame)
ShutterBtn.Size = UDim2.new(0, 25, 0, 25); ShutterBtn.Position = UDim2.new(1, -25, 0, 0)
ShutterBtn.Text = "▲"; ShutterBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 60); ShutterBtn.TextColor3 = Color3.new(1, 1, 1)

local LockBtn = Instance.new("TextButton", MainFrame)
LockBtn.Size = UDim2.new(1, -10, 0, 35); LockBtn.Position = UDim2.new(0, 5, 0, 30)
LockBtn.BackgroundColor3 = Color3.fromRGB(40, 40, 40); LockBtn.Text = "SMART-LOCK: OFF"; LockBtn.TextColor3 = Color3.new(1, 1, 1)

local SpeedLabel = Instance.new("TextLabel", MainFrame)
SpeedLabel.Size = UDim2.new(1, 0, 0, 20); SpeedLabel.Position = UDim2.new(0, 0, 0, 70)
SpeedLabel.Text = "BULLET SPEED: 250"; SpeedLabel.TextColor3 = Color3.new(1, 1, 1); SpeedLabel.BackgroundTransparency = 1; SpeedLabel.TextSize = 11

local PlusBtn = Instance.new("TextButton", MainFrame)
PlusBtn.Size = UDim2.new(0.5, -7, 0, 20); PlusBtn.Position = UDim2.new(0, 5, 0, 90)
PlusBtn.Text = "+"; PlusBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 50); PlusBtn.TextColor3 = Color3.new(1, 1, 1)

local MinusBtn = Instance.new("TextButton", MainFrame)
MinusBtn.Size = UDim2.new(0.5, -7, 0, 20); MinusBtn.Position = UDim2.new(0.5, 2, 0, 90)
MinusBtn.Text = "-"; MinusBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 50); MinusBtn.TextColor3 = Color3.new(1, 1, 1)

local TeamBtn = Instance.new("TextButton", MainFrame)
TeamBtn.Size = UDim2.new(1, -10, 0, 20); TeamBtn.Position = UDim2.new(0, 5, 0, 115)
TeamBtn.BackgroundColor3 = Color3.fromRGB(120, 0, 0); TeamBtn.Text = "TEAM: OFF"; TeamBtn.TextColor3 = Color3.new(1, 1, 1)


local function ShouldTarget(plr)
    if not plr or plr == LP or not plr.Character or not plr.Character:FindFirstChild("Head") or plr.Character.Humanoid.Health <= 0 then return false end
    if Config.TeamCheck and plr.Team == LP.Team then return false end
    return true
end

local function GetClosestTarget()
    local closest, dist = nil, math.huge
    for _, v in pairs(Players:GetPlayers()) do
        if ShouldTarget(v) then
            local d = (v.Character.Head.Position - LP.Character.Head.Position).Magnitude
            if d < dist then dist = d; closest = v end
        end
    end
    return closest
end


ShutterBtn.MouseButton1Click:Connect(function()
    Config.IsMinimized = not Config.IsMinimized
    MainFrame:TweenSize(Config.IsMinimized and UDim2.new(0, 140, 0, 25) or UDim2.new(0, 140, 0, 140), "Out", "Quart", 0.3, true)
    ShutterBtn.Text = Config.IsMinimized and "▼" or "▲"
end)
PlusBtn.MouseButton1Click:Connect(function() Config.BulletSpeed = Config.BulletSpeed + 50; SpeedLabel.Text = "BULLET SPEED: "..Config.BulletSpeed end)
MinusBtn.MouseButton1Click:Connect(function() Config.BulletSpeed = math.max(50, Config.BulletSpeed - 50); SpeedLabel.Text = "BULLET SPEED: "..Config.BulletSpeed end)
LockBtn.MouseButton1Click:Connect(function()
    Config.Locked = not Config.Locked
    LockBtn.BackgroundColor3 = Config.Locked and Color3.fromRGB(0, 150, 255) or Color3.fromRGB(40, 40, 40)
    LockBtn.Text = Config.Locked and "SMART-LOCK: ON" or "SMART-LOCK: OFF"
end)
TeamBtn.MouseButton1Click:Connect(function()
    Config.TeamCheck = not Config.TeamCheck
    TeamBtn.Text = Config.TeamCheck and "TEAM: OFF" or "TEAM: ON"
    TeamBtn.BackgroundColor3 = Config.TeamCheck and Color3.fromRGB(120, 0, 0) or Color3.fromRGB(0, 120, 0)
end)

RunService.RenderStepped:Connect(function()
    if Config.Locked then
        local currentTime = tick()
        
    
        if not Config.Target or not ShouldTarget(Config.Target) or (currentTime - Config.LastTargetTime) > Config.LockDelay then
            local newTarget = GetClosestTarget()
            if newTarget ~= Config.Target then
                Config.Target = newTarget
                Config.LastTargetTime = currentTime
            end
        end
        
        if Config.Target and Config.Target.Character and Config.Target.Character:FindFirstChild("Head") then
            local head = Config.Target.Character.Head
            local root = Config.Target.Character:FindFirstChild("HumanoidRootPart")
            if root then
                local dist = (head.Position - Camera.CFrame.Position).Magnitude
                local predictPos = head.Position + (root.Velocity * (dist / Config.BulletSpeed))
                Camera.CFrame = CFrame.lookAt(Camera.CFrame.Position, predictPos)
            else
                Camera.CFrame = CFrame.lookAt(Camera.CFrame.Position, head.Position)
            end
        end
    end
end)

local function CreateESP(plr)
    if plr == LP then return end
    local Circle = Drawing.new("Circle")
    Circle.Visible = false; Circle.Thickness = 2; Circle.Filled = false
    local Line = Drawing.new("Line")
    Line.Visible = false; Line.Thickness = 2; Line.Color = Color3.fromRGB(0, 255, 255)
    RunService.RenderStepped:Connect(function()
        if plr.Character and plr.Character:FindFirstChild("Head") and plr.Character.Humanoid.Health > 0 then
            if Config.TeamCheck and plr.Team == LP.Team then Circle.Visible = false; Line.Visible = false; return end
            local HeadPos, OnScreen = Camera:WorldToViewportPoint(plr.Character.Head.Position)
            if OnScreen then
                Circle.Position = Vector2.new(HeadPos.X, HeadPos.Y); Circle.Visible = true
                Circle.Color = Color3.fromHSV((plr.Character.Humanoid.Health/plr.Character.Humanoid.MaxHealth)*0.33, 1, 1)
                Circle.Radius = (1500 / HeadPos.Z)
                local LookPoint = plr.Character.Head.Position + (plr.Character.Head.CFrame.LookVector * 5)
                local LookPos, LookOnScreen = Camera:WorldToViewportPoint(LookPoint)
                if LookOnScreen then Line.From = Vector2.new(HeadPos.X, HeadPos.Y); Line.To = Vector2.new(LookPos.X, LookPos.Y); Line.Visible = true else Line.Visible = false end
            else Circle.Visible = false; Line.Visible = false end
        else Circle.Visible = false; Line.Visible = false end
    end)
end
for _, p in pairs(Players:GetPlayers()) do CreateESP(p) end
Players.PlayerAdded:Connect(CreateESP)
